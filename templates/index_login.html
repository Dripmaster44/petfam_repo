<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8"/>
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
        crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
          crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="../css/style.css"/>
  <script>
    jQuery(document).ready(function($)) {
      getUserMe();
    }

    function getUserMe() {
      const auth = getToken();
      var settings = {
        "url": "http://localhost:8080/users/profiles",
        "method": "GET",
        "timeout": 0,
        "headers": {
          "Authorization": xhr.setRequestHeader("Authorization", auth);
        },
      };
      
      $.ajax(settings).done(function (response) {
        console.log(response);
        console.log(response.nickname);
        $('#welcome-text').empty();
        $('#welcome-text').append(response.nickname+'님 반갑습니다.');
      });

      function  getToken() {
        let cName = 'Authorization' + '=';
        let cookieData = document.cookie;
        let cookie = cookieData.indexOf('Authorization');
        let auth = '';
        if(cookie !== -1){
            cookie += cName.length;
            let end = cookieData.indexOf(';', cookie);
            if(end === -1)end = cookieData.length;
            auth = cookieData.substring(cookie, end);
        }
    
        // kakao 로그인 사용한 경우 Bearer 추가
        if(auth.indexOf('Bearer') === -1 && auth !== ''){
            auth = 'Bearer ' + auth;
        }
    
        return auth;
    }
    }
  </script>
  <title>반려동물 자랑 사이트, petfam</title>
</head>
<body>
  <div class="header" style="position: relative;">
    <div id="login-true" style="display: none;">
      <div id="header-title-login-user">
        <div id="username"></div> 님
      </div>
      <div id="header-title-petfam">
        Petfam(펫팸)
      </div>
      <a id="login-text" href="javascript/logout()">
        로그아웃
      </a>
      <a id="home-text" href="/templates/index.html">
        HOME
      </a>
    </div>
    <div id="login-false">
      <div id="header-title-petfam">
        Petfam(펫팸)
      </div>
      <a id="welcome-text">
        ...님 환영합니다.
      </a>
      <a id="sign-text">
        로그아웃
      </a>
      <a id="login-text">
        토큰재발급
      </a>
      <a id="home-text" href="/templates/index.html">
        HOME
      </a>
    </div>
  </div>
<nav class="nav flex-column" id="sidebar-text" style="float: left; margin-right: 50px; width: 200px;">
  <div class="nav-column">
    <a class="nav-link active" id="sidebar-text-each" aria-current="page" style="color: black" href="./posts.html" onclick="petboast()">펫팸 자랑</a>
    <a class="nav-link active" id="sidebar-text-each" aria-current="page" style="color: black" href="#">펫팸 잡담</a>
    <a class="nav-link active" id="sidebar-text-each" aria-current="page" style="color: black" href="#">Q&A게시판</a>
  </div>
</nav>
</body>
</html>